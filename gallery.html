<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!--Bootstrap-->
  <link href="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css" />
  <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

  <!--Style Sheet-->
  <link rel="stylesheet" href="css/gallery.css" />
  <link rel="stylesheet" href="css/home.css" />
  <link rel="stylesheet" href="css/header.css" />
  <link rel="stylesheet" href="css/footer.css" />

  <title>Gallery @KMH</title>

  <link rel="icon" type="image" href="/images/hostel-icon.svg" />
</head>

<body>
  <!--Header-->
  <div id="header"></div>

  <!--Gallery-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/magnific-popup.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/jquery.magnific-popup.js"></script>

  <div class="gallery-container">
    <h1 class="brush_paint">PHOTO GALLERY</h1>

    <div class="portfolio-menu mt-2 mb-4">
      <ol>
        <li class="btn btn-outline-dark active" data-filter="*">All</li>
        <li class="btn btn-outline-dark" data-filter=".FD">Foundation Day</li>
        <li class="btn btn-outline-dark" data-filter=".AD">Annual Day</li>
        <li class="btn btn-outline-dark" data-filter=".F">Farewell</li>
        <li class="btn btn-outline-dark" data-filter=".M">Miscellaneous</li>
      </ol>
    </div>

    <div class="portfolio-item" id="gallery"></div>
  </div>

  <script>
    const imageFolders = {
  FD: 'Foundation_Day',
  AD: 'Annual_Meet',
  F: 'Farewell',
  M: 'Miscellaneous'
};

const imageExtensions = ['jpg', 'jpeg'];
const galleryContainer = document.getElementById('gallery');

const imageExists = async (src) => {
  try {
    const response = await fetch(src, { method: 'HEAD' });
    return response.ok;
  } catch (error) {
    console.error(`Error checking image existence: ${src}`, error);
    return false;
  }
};

const findMaxIndex = async (folder) => {
  let maxIndex = 0;
  for (let i = 1; i <= 50; i++) {
    let found = false;
    for (const ext of imageExtensions) {
      const imgSrc = `./gallery/photo_gallery/${folder}/${i}.${ext}`;
      if (await imageExists(imgSrc)) {
        maxIndex = i;
        found = true;
        break;
      }
    }
    if (!found) break;
  }
  return maxIndex;
};

const loadImages = async () => {
  const fragment = document.createDocumentFragment();

  for (const [key, folder] of Object.entries(imageFolders)) {
    try {
      const maxIndex = await findMaxIndex(folder);

      for (let i = maxIndex; i >= 1; i--) {
        for (const ext of imageExtensions) {
          const imgSrc = `./gallery/photo_gallery/${folder}/${i}.${ext}`;
          if (await imageExists(imgSrc)) {
            const div = document.createElement('div');
            div.className = `item ${key}`;
            div.innerHTML = `
              <a href="${imgSrc}" class="fancylight popup-btn" data-fancybox-group="light">
                <img class="img-fluid" src="${imgSrc}" alt="${folder} ${i}" title="${folder} ${i}" loading="lazy" />
              </a>
            `;
            fragment.appendChild(div);
            break;
          }
        }
      }
    } catch (error) {
      console.error(`Error loading images for ${folder}:`, error);
    }
  }

  galleryContainer.appendChild(fragment);

  // Initialize Magnific Popup after all images are loaded
  if (typeof $.fn.magnificPopup === 'function') {
    $('.portfolio-item').magnificPopup({
      delegate: 'a.fancylight',
      type: 'image',
      gallery: {
        enabled: true
      }
    });
  } else {
    console.warn('Magnific Popup not found. Make sure you have included the library.');
  }
};

// Wait for DOM to be fully loaded
document.addEventListener('DOMContentLoaded', loadImages);
  </script>

  <!--Footer-->
  <div id="footer"></div>

  <!-- JavaScript -->
  <script src="./javascript/script.js"></script>
  <script src="./javascript/home.js"></script>
  <script src="./javascript/gallery.js"></script>
</body>

</html>
